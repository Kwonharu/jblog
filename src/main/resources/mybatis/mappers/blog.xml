<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog">

	<!-- 회원가입 시 블로그 타이틀 생성 -->
	<insert id="insertBlogTitle" parameterType="com.javaex.vo.UserVo">
		<![CDATA[
			insert into blog
			values(#{id}, #{userName} || '의 블로그입니다.', 'spring-logo.jpg')
		]]>
	</insert>

	<!-- id로 블로그 찾기-화면 출력용 -->
	<select id="selectOneBlogWithId" parameterType="String" resultType="com.javaex.vo.BlogVo">
		<![CDATA[
			select  id,
			        blogTitle,
			        logoFile
			from blog
			where id = #{id}
		]]>
	</select>
	
	<!-- 블로그 기본 업데이트 -->
	<update id="updateBlogBasic" parameterType="com.javaex.vo.BlogVo">
		<![CDATA[
			update blog
			set blogTitle = #{blogTitle},
			    logoFile = #{logoFile}
			where id = #{id}
		]]>
	</update>
	
	
	<!-- 카테고리 리스트 -->
	<select id="selectCateList" parameterType="String" resultType="com.javaex.vo.CategoryVo">
		<![CDATA[
			select  pos.rn cateRowNum,
			        c.cateNo cateNo,
			        pos.coun postCount,
			        c.id id,
			        c.cateName cateName,
			        c.description description,
			        c.regDate regDate 
			from category c, blog b, (select  rownum rn,
			                                  p.co coun,
			                                  p.cateNo cateNo
			                          from (select count(po.postNo) co,
			                                       ca.cateNo cateNo
			                                from post po, category ca
			                                where po.cateNo = ca.cateNo
			                                group by ca.cateNo) p
			                         ) pos
			where c.id = b.id
			and pos.cateNo = c.cateNo
			and c.id = #{id}
			order by c.regDate desc
		]]>
	</select>
	
</mapper>



